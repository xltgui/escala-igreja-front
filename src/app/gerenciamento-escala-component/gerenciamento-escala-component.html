<!-- Gerenciamento de Escala -->
<section class="escala-section">
    <div class="d-flex justify-content-between align-items-center mb-3">
        @if (isAdmin()) {
            <h2 class="section-title">Gerenciamento de Escala</h2>
        } @else {
            <h2 class="section-title">Visualização da Escala</h2>
        }
        <div class="action-buttons">
            <button class="btn btn-outline-primary me-2" *ngIf="isAdmin()" (click)="editarEscala()">
                <i class="fas fa-edit me-1"></i>Editar Escala
            </button>
            <button class="btn btn-success">
                <i class="fas fa-file-pdf me-1"></i>Exportar PDF
            </button>
        </div>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-hover escala-table">
            <thead class="table-dark">
                <tr>
                    <th>Data</th>
                    <th>Hora</th>
                    <th>Coroinhas</th>
                    <th>Vela</th>
                    <th>Missal</th>
                    <th>Turíbulo</th>
                    <th>Naveta</th>
                </tr>
            </thead>
            <tbody>
                <!-- Iteração sobre os schedules da API -->
                <tr *ngFor="let schedule of schedules">
                    <td>
                        <strong>{{ schedule.date | date:'dd/MM/yyyy' }}</strong>
                    </td>
                    <td>
                        <strong>{{ schedule.time.slice(0, 5) }}</strong>
                    </td>
                    
                    <!-- Coluna Coroinhas (máximo 4) -->
                    <td>
                        <ul class="list-unstyled mb-0">
                            <li *ngFor="let coroinha of getCoroinhas(schedule.assignments)">
                                {{ coroinha }}
                            </li>
                            <li *ngIf="getCoroinhas(schedule.assignments).length === 0" class="text-muted">
                                -
                            </li>
                        </ul>
                    </td>
                    
                    <!-- Coluna Vela (máximo 2) -->
                    <td>
                        <ul class="list-unstyled mb-0">
                            <li *ngFor="let vela of getVelas(schedule.assignments)">
                                {{ vela }}
                            </li>
                            <li *ngIf="getVelas(schedule.assignments).length === 0" class="text-muted">
                                -
                            </li>
                        </ul>
                    </td>
                    
                    <!-- Coluna Missal -->
                    <td>
                        <span [class.funcao-vazia]="getByRole(schedule.assignments, 'MISSAL') === '-'">
                            {{ getByRole(schedule.assignments, 'MISSAL') }}
                        </span>
                    </td>
                    
                    <!-- Coluna Turíbulo -->
                    <td>
                        <span [class.funcao-vazia]="getByRole(schedule.assignments, 'TURIBULO') === '-'">
                            {{ getByRole(schedule.assignments, 'TURIBULO') }}
                        </span>
                    </td>
                    
                    <!-- Coluna Naveta -->
                    <td>
                        <span [class.funcao-vazia]="getByRole(schedule.assignments, 'NAVETA') === '-'">
                            {{ getByRole(schedule.assignments, 'NAVETA') }}
                        </span>
                    </td>
                </tr>
                
                <!-- Mensagem quando não há dados -->
                <tr *ngIf="schedules.length === 0">
                    <td colspan="7" class="text-center text-muted py-4">
                        <i class="fas fa-inbox fa-2x mb-3 d-block"></i>
                        Nenhuma escala encontrada para o período selecionado.
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</section>